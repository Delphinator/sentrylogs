#!/usr/bin/env python
"""Standalone script for Sentry Logs"""
from __future__ import print_function

import argparse
import os


def main():
    """Main entry point of console script"""
    parser = argparse.ArgumentParser(description='Send logs to Django Sentry.')

    parser.add_argument('--follow', '-f', default="all", help='Which logs to follow, default ALL')
    parser.add_argument('--sentrydsn', '-s', default="", help='The Sentry DSN string')
    parser.add_argument('--daemonize', '-d', action='store_const', const=True, default=False,
                        help='Run this script in background')
    parser.add_argument('--nginxerrorpath', '-n', default=False, help='Nginx error log path')

    args = parser.parse_args()

    print('Start sending %s logs to Sentry' % args.follow)
    if args.sentrydsn:
        print('Using the DSN %s' % args.sentrydsn)
        os.environ['SENTRY_DSN'] = args.sentrydsn
    if args.nginxerrorpath:
        print('Using the Nginx error log path %s' % args.nginxerrorpath)
        os.environ['NGINX_ERROR_PATH'] = args.nginxerrorpath
    if args.daemonize:
        print('Process running in background')
        from sentrylogs.daemonize import create_daemon  # pylint: disable=no-name-in-module
        create_daemon()

    from sentrylogs.parsers.nginx import Nginx
    Nginx().follow_tail()


if __name__ == '__main__':
    main()
